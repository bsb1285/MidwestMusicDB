@page "/{username}"
@inject HttpClient client
@inject IJSRuntime js
@using MidwestMusicDB.Client.Pages.Playlist

<h3>UserHome</h3>
<a href="/song/@username">Search for Songs</a>
<a href="/user/@username">Search for Users</a>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Followers</th>
        <th>Following</th>
    </tr>
    <td>@followers</td>
    <td><a href="/@username/following">@following</a></td>
    </thead>
</table>
<h1> Playlists</h1>
<PlaylistTable Playlists="@_playlists" Username="@username"></PlaylistTable>
<h1>Top Metrics</h1>
<h2>Your Metrics</h2>
<TopTable name="Top Artists" dataType="Artist" topData="@topAritsts"></TopTable>
<TopTable name="For you" dataType="Song" topData="@foryou"></TopTable>
<h2>Global Metrics</h2>
<TopTable name="Top Songs" dataType="Song" topData="@topSongs"></TopTable>
<TopTable name="Top Songs Among My Friends" dataType="Song" topData="@topSongsFriends"></TopTable>
<TopTable name="Top Genres" dataType="Genre" topData="@topGenre"></TopTable>
@code {

    [Parameter]
    public string username { get; set; }

    int followers { get; set; }
    int following { get; set; }
    Playlist[] _playlists { get; set; }
    string[] topAritsts { get; set; }
    string[] topSongs { get; set; }
    string[] topGenre { get; set; }
    string[] topSongsFriends { get; set; }
    string[] foryou { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        var followData = await client.GetJsonAsync<int[]>($"api/user/{username}/{1}");
        followers = followData[1];
        following = followData[0];

        _playlists = await client.GetJsonAsync<Playlist[]>($"api/playlist/{username}");

        var metricType = "artists";
        topAritsts = await client.GetJsonAsync<string[]>($"api/metric/{username}/{metricType}");
        
        metricType = "songs";
        //topSongs = await client.GetJsonAsync<string[]>($"api/metric/global/{metricType}");

        metricType = "friends";
        topSongsFriends = await client.GetJsonAsync<string[]>($"api/metric/{username}/{metricType}");

        metricType = "genre";
        topGenre = await client.GetJsonAsync<string[]>($"api/metric/global/{metricType}");

        metricType = "foryou";
        foryou = await client.GetJsonAsync<string[]>($"api/metric/{username}/{metricType}");
    }
}